#!/bin/bash

function test_close_task_success {
    setup_task "1234" "minor"

    create_commit
    create_commit
    git push origin feature/1234

    close-task.sh "completed feature message"

    test ! -f ".CI_TASKID"
    test ! -f ".CI_NEXTRELEASE"
    test "$(git rev-parse master^2)" = "$(git rev-parse feature/1234)"
    test "$(git log -1 --format="%s")" = "rif. #1234:minor:completed feature message"
}

function test_close_task_success_without_merge_message {
    setup_task "1234" "minor"

    create_commit
    create_commit
    git push origin feature/1234

    close-task.sh

    test ! -f ".CI_TASKID"
    test ! -f ".CI_NEXTRELEASE"
    test "$(git rev-parse master^2)" = "$(git rev-parse feature/1234)"
    test "$(git log -1 --format="%s")" = "rif. #1234:minor:Merged branch feature/1234"
}